<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mirage AR Demo</title>

    <!-- A-Frame + AR.js -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@master/aframe/build/aframe-ar.js"></script>

    <!-- Tailwind for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body { margin: 0; overflow: hidden; }
      #gpsLog {
        position: fixed;
        bottom: 0.5rem;
        left: 0.5rem;
        background: rgba(0, 0, 0, 0.6);
        color: #0f0;
        font-family: monospace;
        font-size: 0.8rem;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        z-index: 999;
      }
    </style>
  </head>

  <body class="bg-black">
    <!-- Scene -->
    <a-scene
      embedded
      arjs="sourceType: webcam; detectionMode: mono; patternRatio: 0.9;"
      renderer="antialias: true; logarithmicDepthBuffer: true;"
      vr-mode-ui="enabled: false"
    >
      <!-- Marker -->
      <a-marker type="pattern" url="public/pattern-hiro.patt" id="hiroMarker">
        <!-- 3D Button plane -->
        <a-entity
          geometry="primitive: plane; width: 1.2; height: 0.4"
          material="color: #FFD700; opacity: 0.9; side: double"
          position="0 0.5 0"
          class="clickable"
          text="value: TAP TO CLAIM; align: center; color: #111; width: 4;"
        ></a-entity>
      </a-marker>

      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <!-- GPS Logger -->
    <div id="gpsLog">Lat: --, Lng: --</div>

    <script>
      // --- GPS Logging ---
      const gpsEl = document.getElementById("gpsLog");

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            gpsEl.textContent = `Lat: ${latitude.toFixed(6)}, Lng: ${longitude.toFixed(6)}`;
            console.log("Current position:", latitude, longitude);
          },
          (err) => {
            gpsEl.textContent = "GPS error: " + err.message;
            console.error(err);
          },
          { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
        );
      } else {
        gpsEl.textContent = "Geolocation not supported";
      }

      // --- Click Event for AR Button ---
      document.addEventListener("DOMContentLoaded", () => {
        const marker = document.getElementById("hiroMarker");

        marker.addEventListener("markerFound", () => {
          console.log("Marker detected!");
        });

        marker.addEventListener("markerLost", () => {
          console.log("Marker lost!");
        });

        const clickable = document.querySelector(".clickable");
        clickable.addEventListener("click", () => {
          alert("You claimed the Hiro marker!");
        });
      });
    </script>
  </body>
</html>
