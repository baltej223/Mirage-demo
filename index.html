<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Marker + Geo AR</title>
    <meta name="description" content="Hello, AR World! ‚Ä¢ A-Frame">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent('follow-shadow', {
        schema: { type: 'selector' },
        init() { this.el.object3D.renderOrder = -1; },
        tick() {
          if (this.data) {
            this.el.object3D.position.copy(this.data.object3D.position);
            this.el.object3D.position.y -= 0.001; // stop z-fighting
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-marker preset="hiro">
        <a-box id="geo-cube" position="0 0.5 0" color="red" visible="false"></a-box>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // üéØ Target location (change to your own)
      const targetLat = 30.354068;
      const targetLon = 76.368439;
      const threshold = 10; // meters

      const cube = document.getElementById("geo-cube");

      // üåç Haversine distance formula
      function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371000; // Earth radius in meters
        const toRad = deg => deg * Math.PI / 180;
        const dLat = toRad(lat2 - lat1);
        const dLon = toRad(lon2 - lon1);
        const a =
          Math.sin(dLat / 2) ** 2 +
          Math.cos(toRad(lat1)) *
            Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) ** 2;
        return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      }

      // üöÄ Function to check location periodically
      function checkLocation() {
        if (!navigator.geolocation) {
          alert("Geolocation not supported on this device.");
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            const dist = getDistance(latitude, longitude, targetLat, targetLon);
            console.log(`üìç Distance: ${Math.round(dist)} m`);

            if (dist <= threshold) {
              cube.setAttribute("visible", true);
            } else {
              cube.setAttribute("visible", false);
            }
          },
          (err) => console.error(err),
          { enableHighAccuracy: true }
        );
      }

      // üîÅ Check every 5 seconds (you can change this)
      setInterval(checkLocation, 5000);

      // Do an immediate check on load
      checkLocation();
    </script>
  </body>
</html>
