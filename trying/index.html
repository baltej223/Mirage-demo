<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Geo-Triggered AR Cube</title>
    <meta name="description" content="Geo-triggered AR cube example">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>

</head>

<body>
    <a-scene 
    vr-mode-ui="enabled: false;"
    embedded
    arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;"
    >
        <a-camera gps-camera rotation-reader></a-camera>

        <!-- Marker -->
        <a-marker preset="hiro" id="baseMarker">
            <a-box color="red" position="0 0.5 0"></a-box>
        </a-marker>

        <!-- Cube that will appear at computed GPS position -->
        <a-entity id="remoteCube" gps-entity-place="latitude: 0; longitude: 0" geometry="primitive: box"
            material="color: blue;" visible="false"></a-entity>

        <script>
            const marker = document.getElementById("baseMarker");
            const cube = document.getElementById("remoteCube");

            marker.addEventListener("markerFound", () => {
                console.log("Marker detected â€” setting reference point.");

                navigator.geolocation.getCurrentPosition((pos) => {
                    const baseLat = pos.coords.latitude;
                    const baseLon = pos.coords.longitude;

                    // Example offset: 10m north and 5m east of the marker
                    const offsetLat = baseLat + (10 / 111111);
                    const offsetLon =
                        baseLon + (5 / (111111 * Math.cos(baseLat * Math.PI / 180)));

                    cube.setAttribute(
                        "gps-entity-place",
                        `latitude: ${offsetLat}; longitude: ${offsetLon}`
                    );
                    cube.setAttribute("visible", "true");

                    console.log("Cube placed relative to marker at:", offsetLat, offsetLon);
                });
            });
        </script>

</body>

</html>